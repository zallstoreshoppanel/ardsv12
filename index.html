<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<title>ARDS V13</title>
<link rel="icon" href="data:,">
<style>
:root{
  --bg:#0b0a10; --card:#14121b; --line:#2a2635; --txt:#eae6f7; --muted:#b9b5c7;
  --accent:#8f61ff; --accent2:#bb86ff; --danger:#ff496e; --pill:#1d1827;
}
*{box-sizing:border-box}
html{min-height:100%}
body{
  min-height:100vh; margin:0;
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif; color:var(--txt);
  background:
    radial-gradient(900px 520px at 80% -10%,rgba(126,77,255,.12),transparent 40%),
    radial-gradient(800px 480px at -10% 110%,rgba(187,134,255,.10),transparent 40%),
    var(--bg);
  overflow-y:auto; padding-bottom:80px;
  -webkit-tap-highlight-color: transparent;
}

/* ====== LOGIN PAGE ====== */
.login-overlay{
  position:fixed; inset:0; display:grid; place-items:center; z-index:1000;
  background:radial-gradient(1000px 600px at 80% -10%,rgba(126,77,255,.18),transparent 40%), #0b0a10;
  pointer-events:auto;
}
.login-card{
  width:92%; max-width:380px; background:rgba(25,20,40,.96);
  border:1px solid #2b213f; border-radius:20px; padding:22px;
  box-shadow:0 10px 50px rgba(0,0,0,.6); text-align:center;
}
.login-img{
  width:110px; height:110px; object-fit:cover; display:block; margin:8px auto 12px auto;
  border-radius:16px; border:2px solid #3b2c5f; background:#111;
}
.login-card h2{margin:0 0 16px 0; color:#d9d3ff; letter-spacing:.4px}
.form-row{margin-bottom:12px; text-align:left}
.form-row label{display:block; font-size:13px; color:#c9b6ff; margin-bottom:6px}
.form-row input{
  width:100%; padding:12px; border-radius:12px; border:1px solid #3b2c5f;
  background:#181325; color:#fff; font-size:15px; outline:none
}
.login-btn{
  width:100%; padding:12px; border:none; border-radius:12px; cursor:pointer;
  background:linear-gradient(180deg,var(--accent),var(--accent2)); color:#0f0b18;
  font-weight:800; letter-spacing:.3px; box-shadow:0 8px 30px rgba(171,125,255,.35)
}
.login-sub{
  margin-top:10px; font-size:12px; color:#bfb3da; text-align:center; opacity:.9
}
.login-err{margin-top:10px; color:#ff708d; font-size:13px; min-height:18px; text-align:center}

/* ====== APP ====== */
.appbar{
  position:sticky; top:0; z-index:60; display:flex; align-items:center; justify-content:space-between;
  padding:12px 18px; background:#0e0c14d6; backdrop-filter:blur(8px);
  border-bottom:1px solid #1e1a28;
}
.icon-btn{
  width:42px; height:42px; border-radius:999px; border:1px solid #272335;
  background:#171321; display:grid; place-items:center; cursor:pointer; transition:.15s;
}
.icon-btn:hover{transform:translateY(-1px)}
.brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.6px}
.brand .dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(180deg,var(--accent),var(--accent2))}
.brand .name{font-size:20px}
.drawer{
  position:fixed; top:0; left:0; bottom:0; width:280px; max-width:80vw;
  background:#110f18; border-right:1px solid #241f31;
  transform:translateX(-100%); transition:transform .22s ease; z-index:70;
  padding:16px; overflow-y:auto;
  pointer-events:auto;
}
.drawer.show{transform:none}
.backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(1px);
  z-index:65; display:none; pointer-events:none;
}
.backdrop.show{display:block; pointer-events:auto}
.itm{padding:10px;border-radius:10px;cursor:pointer} .itm:hover{background:#191426}
.container{max-width:420px; margin:22px auto 0 auto; padding:0 16px}
.profile{display:grid; place-items:center; gap:14px; margin-top:6px; margin-bottom:10px}
.ava-wrap{
  width:138px;height:138px;border-radius:50%;display:grid;place-items:center;
  background:conic-gradient(from 0deg, rgba(187,134,255,.25), rgba(141,97,255,.2), transparent 80%);
  box-shadow:0 0 30px rgba(187,134,255,.25), inset 0 0 18px rgba(187,134,255,.12)
}
.ava{
  width:120px;height:120px;border-radius:50%;border:3px solid #2f2940;
  box-shadow:0 0 40px rgba(169,133,255,.35) inset; background:#222 center/cover no-repeat
}
.role-pill{
  display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:999px;
  background:var(--pill);border:1px solid #2b2436;color:#d4c8ff;font-weight:600
}
.role-dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(180deg,var(--accent),var(--accent2))}
.card{
  background:linear-gradient(180deg,#14111c,#120f19);
  border:1px solid var(--line); border-radius:18px; overflow:hidden;
  box-shadow:0 0 20px rgba(0,0,0,.35)
}
.banner{aspect-ratio:16/9; width:100%; background:#111 center/cover no-repeat}
.section-title{
  margin-top:16px; margin-bottom:10px; padding:12px 16px; border-radius:14px;
  background:linear-gradient(90deg,rgba(141,97,255,.18),rgba(187,134,255,.14));
  border:1px solid #2d2540; font-weight:800
}
.input-wrap{
  display:flex; align-items:center; gap:12px; padding:14px; border-radius:14px;
  background:var(--card); border:1px solid var(--line)
}
.input-wrap input{
  flex:1; background:transparent; border:none; outline:none; color:var(--txt); font-size:15px
}
.input-icon{opacity:.9}
.select-wrap{ position:relative; }
.select{
  background:var(--card); border:1px solid var(--line);
  border-radius:14px; display:flex; align-items:center; padding:14px; cursor:pointer;
  user-select:none;
}
.select .label{flex:1; color:#d9d3ee}
.select .arrow{transition:.22s}
.select-wrap.open .arrow{transform:rotate(180deg)}
.options{
  position:absolute; left:0; right:0; bottom:calc(100% + 6px);
  background:var(--card); border:1px solid var(--line); border-radius:14px; padding:8px;
  display:none; z-index:10000;
  transform-origin:bottom center; opacity:0; transform:translateY(6px) scale(.98);
}
.select-wrap.open .options{display:block; animation:drop .18s forwards}
@keyframes drop{to{opacity:1; transform:translateY(0) scale(1)}}
.opt{padding:12px;border-radius:10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.opt:hover{background:#1a1524}
.small{font-size:12px;color:#b9b5c7}
.btn{
  width:100%; margin-top:14px; background:linear-gradient(180deg,var(--accent),var(--accent2));
  border:none; color:#0f0b18; font-weight:900; letter-spacing:.4px; padding:14px; border-radius:14px;
  cursor:pointer; box-shadow:0 10px 40px rgba(171,125,255,.35); transition:.15s
}
.btn:active{transform:translateY(1px)}
.btn-ghost{background:#181320;border:1px solid #2b2436;color:#e9defe;padding:10px 14px;border-radius:12px;cursor:pointer}
.btn-primary{background:linear-gradient(180deg,var(--accent),var(--accent2));border:none;color:#0f0b18;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800}
.navbar{
  position:fixed; left:0; right:0; bottom:0; height:64px;
  background:#0e0c14f2; backdrop-filter:blur(8px);
  border-top:1px solid #201b2b; display:flex; justify-content:space-around; align-items:center;
  z-index:55
}
.nav-item{
  width:110px; display:flex; flex-direction:column; align-items:center; gap:4px;
  padding:8px; border-radius:12px; cursor:pointer; border:1px solid transparent
}
.nav-item.active{background:#161220; border-color:#2a2435}
.nav-item span{font-size:12px;color:#bfb8d4}
.nav-item.active span{color:#e8deff}
.overlay{
  position:fixed; inset:0; background:rgba(0,0,0,.55);
  display:none; pointer-events:none;
  align-items:center; justify-content:center; z-index:80;
}
.overlay.show{display:flex; pointer-events:auto}
.modal{
  width:92%; max-width:420px; background:#130f1a; border:1px solid #2a2137; border-radius:16px;
  padding:16px; box-shadow:0 40px 120px rgba(0,0,0,.6)
}
.modal h4{margin:0 0 8px 0}
.modal p{margin:0 0 10px 0; color:#b9b5c7}
.modal .row{display:flex; gap:10px; justify-content:flex-end}
.toasts{position:fixed; right:14px; bottom:78px; display:flex; flex-direction:column; gap:10px; z-index:85}
.toast{
  background:#171323; border:1px solid #2b2437; border-radius:12px; padding:10px 12px;
  min-width:220px; box-shadow:0 10px 40px rgba(0,0,0,.5);
  opacity:0; transform:translateY(8px); animation:toast .35s forwards
}
@keyframes toast{to{opacity:1; transform:none}}
.progress-wrap{margin-top:6px;background:#15121c;border:1px solid var(--line);border-radius:14px;padding:10px}
.progress{height:12px;border-radius:999px;background:#0f0c15;overflow:hidden;border:1px solid #2b2038}
.progress i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .2s linear}
.progress-label{font-size:12px;color:#b9b5c7;margin-top:6px}
hr.sep{border:none;height:1px;background:#231d2d;margin:14px 0}

/* ceklis hijau */
.done{display:grid;place-items:center;margin-top:12px}
.done svg{width:56px;height:56px;opacity:0;transform:scale(.9);transition:.25s ease}
.done.show svg{opacity:1;transform:scale(1)}

/* ====== CLONE NOTICE POPUP ====== */
.notice-overlay{
  position:fixed; inset:0; display:none; place-items:center;
  background:rgba(0,0,0,.55); backdrop-filter: blur(3px);
  z-index:1200;
}
.notice-overlay.show{ display:grid; }

.notice-box{
  width:92%; max-width:420px; background:#130f1a;
  border:1px solid #2a2137; border-radius:18px; padding:18px 18px 16px 18px;
  box-shadow:0 40px 120px rgba(0,0,0,.6); position:relative;
}
.notice-title{
  margin:0 0 8px 0; font-weight:900; letter-spacing:.4px; color:#ffd166;
}
.notice-body{ color:#eae6f7; line-height:1.4; white-space:pre-line; }
.notice-body b{ color:#bb86ff; }
.notice-close{
  position:absolute; top:8px; right:8px;
  width:36px; height:36px; border-radius:999px;
  border:1px solid #2b2437; background:#1a1524; color:#eae6f7;
  display:grid; place-items:center; cursor:pointer; transition:.15s;
}
.notice-close:hover{ transform:translateY(-1px); }
</style>
</head>
<body>

<!-- ========== LOGIN VIEW ========== -->
<div id="loginView" class="login-overlay">
  <div class="login-card">
    <img src="https://files.catbox.moe/icnoar.jpg" alt="logo" class="login-img">
    <h2>Login ARDS V13</h2>
    <div class="form-row">
      <label>Username</label>
      <input id="loginUser" type="text" placeholder="Contoh: IDANGZ">
    </div>
    <div class="form-row">
      <label>Password</label>
      <input id="loginPass" type="password" placeholder="Contoh: 123321">
    </div>
    <button class="login-btn" id="btnDoLogin" type="button">LOGIN</button>
    <div class="login-err" id="loginErr"></div>
    <div class="login-sub">Masukkan <b>username</b></div>
  </div>
</div>

<!-- ========== APP UTAMA ========== -->
<div id="appRoot" hidden>
  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="itm" id="itmAbout">Tentang Aplikasi</div>
    <div class="itm" id="itmHistory">Riwayat Eksekusi</div>
  </aside>
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>
  <header class="appbar">
    <button class="icon-btn" id="btnHamburger" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="#cfc3ff"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/></svg></button>
    <div class="brand"><div class="dot"></div><div class="name">ARDS V13</div></div>
    <button class="icon-btn" id="btnProfile" type="button"><svg width="22" height="22" viewBox="0 0 24 24" fill="#cfc3ff"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5V22h18v-2.5C21 16.5 17 14 12 14Z"/></svg></button>
  </header>

  <main class="container" id="tabWhatsApp">
    <section class="profile">
      <div class="ava-wrap"><div class="ava" id="avatar"></div></div>
      <div class="role-pill"><span class="role-dot"></span><span>Role: BUYER • Exp: Akan datang</span></div>
    </section>
    <article class="card"><div class="banner" id="banner"></div></article>
    <div class="section-title">Nomor Target</div>
    <div class="input-wrap">
      <div class="input-icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="#cfc3ff"><path d="M6.6 10.8a15.9 15.9 0 0 0 6.6 6.6l2.2-2.2a1 1 0 0 1 1-.25 11.1 11.1 0 0 0 3.5.55 1 1 0 0 1 1 1V20a1 1 0 0 1-1 1A17 17 0 0 1 3 7a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1 11.1 11.1 0 0 1 .55 3.5 1 1 0 0 1-.25 1Z"/></svg>
      </div>
      <input id="phone" type="tel" placeholder="Contoh: +62xxxxxxxxxxx">
    </div>
    <div class="section-title">Pilih Bug</div>
    <div class="select-wrap" id="bugWrap">
      <div class="select" id="selectBug"><div class="label" id="bugLabel">BUG ANDROID</div>
        <svg class="arrow" width="18" height="18" viewBox="0 0 24 24" fill="#cfc3ff"><path d="m7 10 5 5 5-5z"/></svg>
      </div>
      <div class="options" id="bugOptions">
        <div class="opt" data-val="BUG ANDROID">BUG ANDROID <span class="small">visual</span></div>
        <div class="opt" data-val="BUG LAG">BUG LAG <span class="small">slowdown</span></div>
        <div class="opt" data-val="BUG CRASH">BUG CRASH <span class="small">force-close</span></div>
        <div class="opt" data-val="BUG KERNEL">BUG KERNEL <span class="small">critical</span></div>
      </div>
    </div>
    <button class="btn" id="btnRun" type="button">EKSEKUSI</button>
    <hr class="sep">
    <div class="small">ARDS V13</div>
  </main>

  <section class="container" id="tabHome" hidden>
    <div class="section-title">Home</div>
    <article class="card" style="padding:16px"><p class="small">Selamat datang di ARDS V13.</p></article>
  </section>

  <section class="container" id="tabTools" hidden>
    <div class="section-title">Tools</div>
    <article class="card" style="padding:40px; display:grid; place-items:center;">
      <div style="font-size:32px; font-weight:900; letter-spacing:2px; opacity:.9">COMMING SOON</div>
    </article>
  </section>

  <nav class="navbar">
    <div class="nav-item" data-tab="tabHome"><svg width="22" height="22" viewBox="0 0 24 24" fill="#cfc3ff"><path d="M12 3 2 12h3v8h6v-6h2v6h6v-8h3z"/></svg><span>Home</span></div>
    <div class="nav-item active" data-tab="tabWhatsApp"><svg width="22" height="22" viewBox="0 0 24 24" fill="#cfc3ff"><path d="M20 3H4v16l4-4h12z"/></svg><span>WhatsApp</span></div>
    <div class="nav-item" data-tab="tabTools"><svg width="22" height="22" viewBox="0 0 24 24" fill="#cfc3ff"><path d="M10 3h4l1 3h3l-2 3 2 3h-3l-1 3h-4l-1-3H5l2-3-2-3h3z"/></svg><span>Tools</span></div>
  </nav>

  <div class="overlay" id="overlay">
    <div class="modal">
      <h4 id="mTitle">Judul</h4>
      <p id="mDesc">Deskripsi</p>
      <div id="modalProgress" hidden>
        <div class="progress-wrap">
          <div class="progress"><i id="bar"></i></div>
          <div class="progress-label" id="barLabel">Menyiapkan…</div>
        </div>
        <div class="done" id="doneIcon" hidden aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="#2ecc71" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" stroke="#2ecc71" fill="rgba(46,204,113,.12)"></circle>
            <path d="M8 12l3 3 5-6"></path>
          </svg>
        </div>
      </div>
      <div class="row" id="modalBtns">
        <button class="btn-ghost" id="mCancel" type="button">Batal</button>
        <button class="btn-primary" id="mOk" type="button">OK</button>
      </div>
    </div>
  </div>
  <div class="toasts" id="toasts"></div>

  <!-- ===== Popup CLONE NOTICE ===== -->
  <div id="cloneNotice" class="notice-overlay" aria-hidden="true">
    <div class="notice-box" role="dialog" aria-modal="true" aria-labelledby="noticeTitle">
      <button class="notice-close" id="cloneNoticeClose" type="button" aria-label="Tutup">✕</button>
      <h4 class="notice-title" id="noticeTitle">BEWARE CLONE</h4>
      <div class="notice-body">
YG REAL HANYA

TELE : <b>@ARDSDEV</b>
WA   : <b>08131314294</b>
      </div>
    </div>
  </div>
  <!-- ===== /Popup CLONE NOTICE ===== -->

</div><!-- /#appRoot -->

<!-- ===== Firebase Auth (username -> email @gmail.com, login wajib) ===== -->
<script type="module">
const loginView = document.getElementById('loginView');
const appRoot   = document.getElementById('appRoot');
const userEl    = document.getElementById('loginUser');
const passEl    = document.getElementById('loginPass');
const btnLogin  = document.getElementById('btnDoLogin');
const errEl     = document.getElementById('loginErr');

function showErr(msg){ errEl.textContent = msg || 'Terjadi kesalahan.'; }
function setBtnBusy(b){ btnLogin.disabled = b; btnLogin.textContent = b ? 'MEMPROSES…' : 'LOGIN'; }
function enterApp(){
  appRoot.hidden = false;
  if (loginView && loginView.parentNode) loginView.remove();
  document.body.style.overflowY = 'auto';
  // panggil notice setelah view muncul
  setTimeout(()=>{ window.showCloneNotice && window.showCloneNotice(); }, 0);
}
function showLogin(){
  appRoot.hidden = true;
  loginView.style.display = 'grid';
}

(async () => {
  try {
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js");
    const {
      getAuth, setPersistence, inMemoryPersistence,
      onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword
    } = await import("https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js");

    const firebaseConfig = {
      apiKey: "AIzaSyArE6B5jQCSECpOusTxrOYmUsjeFEa17YI",
      authDomain: "bugwa-1fc47.firebaseapp.com",
      projectId: "bugwa-1fc47",
      storageBucket: "bugwa-1fc47.firebasestorage.app",
      messagingSenderId: "309575475227",
      appId: "1:309575475227:web:c2a7a9123afb30023698be"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // wajib login setiap refresh
    await setPersistence(auth, inMemoryPersistence);

    onAuthStateChanged(auth, (user) => {
      if (user) enterApp(); else showLogin();
    });

    btnLogin.addEventListener('click', async () => {
      errEl.textContent = '';
      const username = (userEl.value || '').trim();
      const password = (passEl.value || '');
      if (!username || !password) { showErr('Username & password wajib diisi.'); return; }

      const email = `${username}@gmail.com`.toLowerCase();
      setBtnBusy(true);
      try {
        await signInWithEmailAndPassword(auth, email, password);
        enterApp();
      } catch (e) {
        if (e.code === 'auth/user-not-found') {
          try {
            await createUserWithEmailAndPassword(auth, email, password);
            enterApp();
          } catch (er) {
            showErr(mapErr(er));
          }
        } else {
          showErr(mapErr(e));
        }
      } finally {
        setBtnBusy(false);
      }
    });

    function mapErr(e){
      switch(e.code){
        case 'auth/wrong-password': return 'Password salah.';
        case 'auth/invalid-email': return 'Username tidak valid.';
        case 'auth/weak-password': return 'Password minimal 6 karakter.';
        case 'auth/email-already-in-use': return 'Username sudah terdaftar.';
        default: return 'Gagal login: ' + (e?.message || e?.code || 'Tidak diketahui');
      }
    }

  } catch (e) {
    showErr('Gagal memuat Firebase. Cek koneksi / izin CDN.');
    showLogin();
  }
})();
</script>

<!-- ===== Script App ===== -->
<script>
/* ==== Ganti dengan URL gambar kamu ==== */
const AVATAR_URL = "https://files.catbox.moe/icnoar.jpg";
const BANNER_URL = "https://files.catbox.moe/75y814.jpg";

/* ==== Utils ==== */
const $=(s,c=document)=>c.querySelector(s), $$=(s,c=document)=>Array.from(c.querySelectorAll(s));
function toast(msg,ms=2200){
  const t=document.createElement('div');
  t.className='toast'; t.textContent=msg;
  $('#toasts').appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateY(8px)';setTimeout(()=>t.remove(),220)},ms);
}

/* ==== Loader gambar dengan fallback ==== */
function setBgImage(el, url, fallback){
  if(!el) return;
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.onload = ()=>{ el.style.backgroundImage = `url('${url}')`; };
  img.onerror = ()=>{ el.style.backgroundImage = `url('${fallback}')`; };
  img.src = url;
}

/* ==== Drawer ==== */
function openDrawer(){ $('#drawer').classList.add('show'); $('#backdrop').classList.add('show'); }
function closeDrawer(){ $('#drawer').classList.remove('show'); $('#backdrop').classList.remove('show'); }
$('#btnHamburger').addEventListener('click', openDrawer);
$('#backdrop').addEventListener('click', closeDrawer);

/* Drawer item actions */
$('#itmAbout').addEventListener('click',()=>{
  closeDrawer();
  showModal({title:'Tentang ARDS V13',desc:'INI ADALAH APK BUG ARDS VERSION TERBARU VERSI 13 DAN AKAN MELANJUTKAN VERSI KE V14 DI NEXT DAN FITUR TOOLS AKAN KEBUKA',ok:'Mengerti',hideCancel:true});
});
const historyLog=[];
$('#itmHistory').addEventListener('click',()=>{
  closeDrawer();
  const msg = historyLog.length ? historyLog.slice(-5).map((h,i)=>`${i+1}. ${h}`).join('\n') : 'Belum ada eksekusi.';
  showModal({title:'Riwayat Eksekusi',desc:msg,ok:'Tutup',hideCancel:true});
});
$('#btnProfile').addEventListener('click',()=> toast('BUYER • ARDS V13'));

/* ==== Tabs ==== */
$$('.nav-item').forEach(it=>{
  it.addEventListener('click',()=>{
    $$('.nav-item').forEach(n=>n.classList.remove('active'));
    it.classList.add('active');
    const tab = it.getAttribute('data-tab');
    ['tabHome','tabWhatsApp','tabTools'].forEach(id=> $('#'+id).hidden = id!==tab);
  });
});

/* ==== Validasi nomor ==== */
function isValidPhone(v){ return /^\+?\d{10,17}$/.test(v.trim()); }

/* ==== Select Bug (wajib isi nomor dulu) ==== */
const bugWrap = $('#bugWrap');
const select = $('#selectBug'), opts = $('#bugOptions'), label = $('#bugLabel');
select.addEventListener('click',(e)=>{
  e.stopPropagation();
  const phone = $('#phone').value;
  if(!isValidPhone(phone)){
    showModal({title:'Isi Nomor Target',desc:'Sebelum memilih bug, masukkan nomor target.\nContoh: +62812xxxxxxx',ok:'OK',hideCancel:true});
    return;
  }
  bugWrap.classList.toggle('open');
  select.setAttribute('aria-expanded', bugWrap.classList.contains('open'));
});
opts.addEventListener('click',e=>{
  const o = e.target.closest('.opt'); if(!o) return;
  label.textContent = o.dataset.val;
  bugWrap.classList.remove('open');
  select.setAttribute('aria-expanded','false');
  toast('Dipilih: '+o.dataset.val,1600);
});
document.addEventListener('click',e=>{
  if(!bugWrap.contains(e.target)) { bugWrap.classList.remove('open'); select.setAttribute('aria-expanded','false'); }
});

/* ==== Modal Helper ==== */
function showModal({title,desc,ok='OK',cancel='Batal',onOk=null,onCancel=null,hideCancel=false}) {
  $('#mTitle').textContent=title; $('#mDesc').textContent=desc;
  $('#mOk').textContent=ok; $('#mCancel').textContent=cancel;
  $('#mCancel').style.display = hideCancel?'none':'inline-block';
  const ov = $('#overlay'); ov.classList.add('show'); ov.setAttribute('aria-hidden','false');

  function close(){ ov.classList.remove('show'); ov.setAttribute('aria-hidden','true');
    okBtn.removeEventListener('click',okfn); cancelBtn.removeEventListener('click',cfn); ov.removeEventListener('click',bg); document.removeEventListener('keydown',onEsc); }
  const okBtn=$('#mOk'), cancelBtn=$('#mCancel');
  const okfn=()=>{ onOk && onOk(); if(!pendingProgress) close(); };
  const cfn=()=>{ onCancel && onCancel(); close(); };
  const bg=(e)=>{ if(e.target===ov) close(); };
  const onEsc=(e)=>{ if(e.key==='Escape') cfn(); };
  okBtn.addEventListener('click', okfn);
  cancelBtn.addEventListener('click', cfn);
  ov.addEventListener('click', bg);
  document.addEventListener('keydown', onEsc);

  let pendingProgress = false;
  return { close, setPendingProgress:(v)=>{ pendingProgress=v; } };
}

/* ==== Progress 20 detik + ceklis hijau + auto-close 2 detik ==== */
let running=false, rafId=null, cancelRequested=false;
const barEl = ()=>$('#bar'), barLabel = ()=>$('#barLabel'), doneIcon=()=>$('#doneIcon');

function stageLabel(p){
  if(p<15) return 'Menyiapkan…';
  if(p<45) return 'Memindai sistem…';
  if(p<75) return 'Menjalankan exploit…';
  if(p<100) return 'Verifikasi hasil…';
  return 'Selesai';
}

function startProgress(kind, phone){
  if(running){ toast('Masih berjalan…'); return; }
  cancelRequested=false;

  // Tampilkan modal progress
  const ov = $('#overlay');
  $('#modalProgress').hidden = false;
  if (barEl()) barEl().style.width = '0%';
  if (barLabel()) barLabel().textContent = 'Menyiapkan…';
  if (doneIcon()){ doneIcon().hidden = true; doneIcon().classList.remove('show'); }

  $('#mTitle').textContent = 'Eksekusi ' + kind;
  $('#mDesc').textContent  = 'Sedang berlangsung untuk ' + phone;

  $('#mOk').textContent = 'Info';
  $('#mCancel').textContent = 'Batal';

  const okBtn=$('#mOk'), cancelBtn=$('#mCancel');
  const bgClick=(e)=>{ if(e.target===ov) finishClose(); };
  function finishClose(){
    ov.classList.remove('show'); ov.setAttribute('aria-hidden','true');
    okBtn.removeEventListener('click',okHandler);
    cancelBtn.removeEventListener('click',cancelHandler);
    ov.removeEventListener('click',bgClick);
    document.removeEventListener('keydown',escHandler);
  }
  function okHandler(){ /* info only */ }
  function cancelHandler(){ cancelRequested=true; stopProgress(); toast('Dibatalkan'); finishClose(); }
  function escHandler(e){ if(e.key==='Escape') cancelHandler(); }

  okBtn.addEventListener('click', okHandler);
  cancelBtn.addEventListener('click', cancelHandler);
  ov.addEventListener('click', bgClick);
  document.addEventListener('keydown', escHandler);

  ov.classList.add('show'); ov.setAttribute('aria-hidden','false');

  const DURATION = 20000; // 20 detik
  const start = performance.now();
  running = true;

  function tick(now){
    if(cancelRequested){ running=false; return; }
    const elapsed = now - start;
    const progress = Math.min(1, elapsed / DURATION);
    const percent = Math.floor(progress * 100);

    if (barEl()) barEl().style.width = percent + '%';
    if (barLabel()) barLabel().textContent = `${stageLabel(percent)} (${percent}%)`;

    if(progress < 1){
      rafId = requestAnimationFrame(tick);
    } else {
      if (barEl()) barEl().style.width = '100%';
      if (barLabel()) barLabel().textContent = 'Selesai (100%)';
      if (doneIcon()){
        doneIcon().hidden = false;
        requestAnimationFrame(()=> doneIcon().classList.add('show'));
      }
      running = false;
      setTimeout(()=>{ finishClose(); toast('Eksekusi selesai ('+kind+')'); }, 2000);
    }
  }
  rafId = requestAnimationFrame(tick);
}

function stopProgress(){
  if(rafId) cancelAnimationFrame(rafId);
  running = false; rafId = null;
}

/* ==== Run (OK langsung munculin popup progress otomatis) ==== */
$('#btnRun').addEventListener('click',()=>{
  const phone = $('#phone').value.trim();
  if(!isValidPhone(phone)){
    showModal({title:'Nomor tidak valid',desc:'Masukkan nomor target. Contoh: +62xxxxxxxxxxx',ok:'OK',hideCancel:true});
    return;
  }
  const kind = $('#bugLabel').textContent;

  const ctrl = showModal({
    title:'Siap Eksekusi',
    desc:`Akan mengeksekusi ${kind} untuk ${phone}. Tekan OK untuk mulai.`,
    ok:'OK', cancel:'Batal',
    onOk:()=>{ ctrl.setPendingProgress(true); ctrl.close(); startProgress(kind, phone); }
  });
});

/* ==== Set avatar & banner ==== */
setBgImage($('#avatar'), AVATAR_URL, 'https://picsum.photos/seed/ards-avatar/300/300');
setBgImage($('#banner'), BANNER_URL, 'https://picsum.photos/seed/ards-banner/1200/675');

/* ==== Proteksi basic (opsional) ==== */
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('copy', e => e.preventDefault());
document.addEventListener('cut', e => e.preventDefault());
document.addEventListener('dragstart', e => e.preventDefault());

/* ==== Show Clone Notice ==== */
function showCloneNotice(){
  const ov = document.getElementById('cloneNotice');
  const btn = document.getElementById('cloneNoticeClose');
  if(!ov || !btn) return;
  ov.classList.add('show');
  ov.setAttribute('aria-hidden','false');
  btn.addEventListener('click', ()=>{
    ov.classList.remove('show');
    ov.setAttribute('aria-hidden','true');
  }, { once:true });
}
window.showCloneNotice = showCloneNotice;
</script>
</body>
</html>
