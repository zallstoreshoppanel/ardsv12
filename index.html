<!DOCTYPE html><html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
<title>ARDS V15 • Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0e1a; --panel:#0f1736; --panel2:#0e1633; --line:#1d2a57;
  --tx:#e8f0ff; --tx2:#9aa6c7; --ok:#23d18b; --warn:#ffb020;
  --ac1:#7b5cff; --ac2:#4ad0ff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Outfit,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
  color:var(--tx); background:var(--bg); overflow:hidden; touch-action:manipulation;
  -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;
}
input,select,.allow-select{-webkit-user-select:text;user-select:text}

/* ===== LOGIN ===== */
.auth-wrap{position:fixed;inset:0;display:grid;place-items:center;z-index:30;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
.auth-card{width:min(520px,92%);border-radius:22px;background:linear-gradient(180deg,#101733,#0d142b);
  border:1px solid #1c2652;box-shadow:0 30px 80px #000a,inset 0 1px 0 #2a356a55;padding:22px}
.auth-header{display:flex;flex-direction:column;align-items:center;gap:.45rem;margin-bottom:.8rem}
.auth-logo{width:66px;height:66px;border-radius:16px;background:#0d1430;display:grid;place-items:center;
  box-shadow:0 6px 18px #0008,inset 0 0 0 6px #0c1230}
.title{font-size:1.45rem;font-weight:800;letter-spacing:.02em}
.subtitle{color:var(--tx2);text-align:center;margin-top:-6px;font-size:.86rem}
.field{margin:.65rem 0}.label{font-size:.8rem;color:var(--tx2);display:flex;align-items:center;gap:.5rem;margin-bottom:.3rem}
.label svg{width:15px;height:15px}
.ipt{display:flex;align-items:center;gap:.55rem;background:#0e1533;border:1px solid #1b2552;color:var(--tx);
  padding:.72rem .85rem;border-radius:14px}.ipt input{all:unset;flex:1;color:var(--tx);font-size:.95rem}
.remember{display:flex;align-items:center;gap:.45rem;color:var(--tx2);margin:.35rem 0 .65rem;font-size:.9rem}
.remember input{accent-color:#6f89ff;width:16px;height:16px}
.btn-grad{width:100%;border:0;cursor:pointer;font-weight:800;letter-spacing:.02em;color:white;padding:12px 14px;border-radius:14px;
  background:linear-gradient(90deg,var(--ac1),var(--ac2));box-shadow:0 10px 24px #0008,0 0 0 1px #2d3a7a inset;transition:.08s}
.btn-grad:active{transform:translateY(1px)}
.muted-center{color:var(--tx2);text-align:center;margin-top:14px;font-size:.82rem}

/* ===== APP ===== */
.phone{max-width:860px;margin:0 auto;width:100%}
.app{position:relative;z-index:1;height:100%;display:grid;grid-template-rows:auto 1fr auto}
.topbar{
  display:flex;align-items:center;gap:.6rem;
  padding:.7rem .9rem env(safe-area-inset-bottom) .9rem;
  background:linear-gradient(180deg,#11183a,#0b122a);
  border-bottom:1px solid #1b244a;box-shadow:0 8px 22px #0006;position:sticky;top:0;z-index:5
}
.brand{font-weight:800;letter-spacing:.06em;font-size:1rem}
.content{overflow:auto;padding:clamp(.7rem,2.5vw,.95rem);padding-bottom:calc(env(safe-area-inset-bottom) + 80px)}
.panel{background:linear-gradient(180deg,#11183a,#0e1633);border:1px solid #1b2550;border-radius:16px;box-shadow:0 12px 30px #0008}
.hero{position:relative;overflow:hidden}
.hero img{display:block;width:100%;height:clamp(140px,24vw,200px);object-fit:cover;filter:saturate(1.05)}
.hero:after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(12,18,40,.35),rgba(12,18,40,.85))}
.cards{display:grid;gap:.7rem}
.card{padding:.8rem;border-radius:14px;background:var(--panel);border:1px solid var(--line)}
.stat{display:flex;align-items:center;justify-content:space-between;padding:.55rem .7rem;border-radius:10px;background:var(--panel2);
  border:1px solid #233064;margin-bottom:.45rem}
.status-dot{width:9px;height:9px;border-radius:50%;background:var(--ok);box-shadow:0 0 10px var(--ok)}
.card h3{margin:.1rem 0 .5rem;font-size:.92rem;color:#cfe0ff}

.bottombar{position:sticky;bottom:0;z-index:5;display:grid;grid-template-columns:repeat(5,1fr);gap:.3rem;padding:.4rem calc(.4rem + env(safe-area-inset-right)) calc(.4rem + env(safe-area-inset-bottom)) calc(.4rem + env(safe-area-inset-left));background:linear-gradient(0deg,#0b1124,#0e1530);
  border-top:1px solid #1b2446}
.tab{display:flex;flex-direction:column;align-items:center;gap:.2rem;padding:.45rem 0;border-radius:10px;color:#a9bbdd;border:1px solid transparent}
.tab.active{background:#0f1736;border-color:#1d2a57;color:#dfe8ff}
.tab svg{width:18px;height:18px}.tab small{font-size:.64rem}
.page{display:none}.page.active{display:block}

/* ===== Hamburger & Drawer ===== */
.hamburger{width:40px;height:40px;border-radius:10px;border:1px solid var(--line);background:#0f1736;
  display:grid;place-items:center;cursor:pointer;position:relative;overflow:hidden}
.hamburger .bars{position:relative;width:20px;height:2px;background:#8ec8ff;border-radius:2px;transition:.25s}
.hamburger .bars:before,.hamburger .bars:after{content:"";position:absolute;left:0;width:20px;height:2px;background:#8ec8ff;border-radius:2px;transition:.25s}
.hamburger .bars:before{top:-6px}.hamburger .bars:after{top:6px}
.hamburger:after{content:"";position:absolute;inset:-45%;background:conic-gradient(from 0deg,transparent,#7b5cff33,transparent 60%);filter:blur(10px);transform:rotate(0deg);transition:.8s}
.hamburger:hover:after{transform:rotate(180deg)}
body.drawer-open .hamburger .bars{background:transparent}
body.drawer-open .hamburger .bars:before{transform:translateY(6px) rotate(45deg)}
body.drawer-open .hamburger .bars:after{transform:translateY(-6px) rotate(-45deg)}

.drawer{position:fixed;top:0;left:0;height:100vh;width:78%;max-width:320px;background:linear-gradient(180deg,#0b1226,#0a1020);
  border-right:1px solid #1b2446;transform:translateX(-100%);transition:transform .28s ease;z-index:60;display:flex;flex-direction:column;
  box-shadow:20px 0 60px #0008}
body.drawer-open .drawer{transform:translateX(0)}
.overlay{position:fixed;inset:0;background:#0009;opacity:0;pointer-events:none;transition:.28s;z-index:59}
body.drawer-open .overlay{opacity:1;pointer-events:auto}

.d-head{padding:16px;border-bottom:1px solid #142045;display:flex;align-items:center;gap:12px}
.avatar-wrap{position:relative;width:54px;height:54px}
.avatar{width:54px;height:54px;border-radius:999px;overflow:hidden;border:3px solid #7b5cff33;box-shadow:0 0 0 2px #2d2355}
.avatar img{width:100%;height:100%;object-fit:cover}
.edit-badge{position:absolute;right:-2px;bottom:-2px;width:20px;height:20px;border-radius:999px;background:linear-gradient(90deg,var(--ac1),var(--ac2));
  display:grid;place-items:center;box-shadow:0 6px 12px #0009;border:1px solid #243065}
.edit-badge svg{width:12px;height:12px;color:#001c2a}

.d-title{font-weight:800}
.badge{display:inline-block;margin-top:4px;font-size:12px;color:#fff;background:linear-gradient(90deg,#825bff,#e26bff);
  padding:4px 10px;border-radius:999px}
.menu{padding:10px}
.item{position:relative;display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;color:#dfe6ff;border:1px solid transparent;overflow:hidden}
.item svg{width:18px;height:18px}
.item::before{content:"";position:absolute;left:8px;top:8px;bottom:8px;width:0;background:linear-gradient(180deg,var(--ac1),var(--ac2));
  border-radius:8px;box-shadow:0 0 0 transparent;transition:.25s}
.item:hover{background:#0f1736;border-color:#1d2a57}
.item:hover::before{width:4px;box-shadow:0 0 10px #79a0ff66}
.item.active{background:#141d46;border-color:#2a3a7a}
.item.active::before{width:6px;box-shadow:0 0 14px #7b5cff88}
.footer{margin-top:auto;padding:12px;color:#7e8db5;font-size:12px;border-top:1px solid #142045}

/* ===== Battery pill ===== */
.battery-pill{margin-left:auto;display:flex;align-items:center;gap:.45rem;padding:.25rem .5rem;border-radius:12px;border:1px solid #1b2a56;background:#0f1736;min-width:86px}
.battery-icon{width:24px;height:12px;border:2px solid #86b9ff;border-radius:3px;position:relative}
.battery-icon:after{content:"";position:absolute;right:-4px;top:2px;width:3px;height:8px;background:#86b9ff;border-radius:1px}
.battery-fill{position:absolute;left:0;top:0;height:100%;width:50%;background:linear-gradient(90deg,#7b5cff,#4ad0ff)}
.battery-txt{font-size:.8rem;color:#cfecff;white-space:nowrap}

/* ===== Music Button ===== */
.music-btn{
  width:40px;height:40px;border-radius:10px;border:1px solid var(--line);
  background:#0f1736;display:grid;place-items:center;cursor:pointer;
  margin-left:.4rem;position:relative;overflow:hidden;
}
.music-btn svg{width:18px;height:18px}
.music-btn.active{border-color:#2bd67b;background:linear-gradient(180deg,#0f1f3a,#0e1730)}
.music-btn.active:after{
  content:"";position:absolute;inset:-50%;
  background:conic-gradient(from 0deg,transparent,#2bd67b33,transparent 60%);
  filter:blur(10px);animation:spin 2s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== Modals ===== */
.modal{position:fixed;inset:0;display:none;place-items:center;z-index:70;background:#0008}
.modal.show{display:grid}
.modal-card{width:min(520px,92%);background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:1rem;text-align:center;box-shadow:0 24px 60px #000c}
.progress{height:12px;background:var(--panel2);border:1px solid #233064;border-radius:10px;overflow:hidden;margin:.4rem 0}
.progress i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--ac1),var(--ac2))}
.meta{display:flex;justify-content:space-between;color:var(--tx2);margin:.4rem 0 .2rem;font-size:.82rem}
.indicator{margin-top:.35rem;padding:.5rem;border:1px solid #233064;border-radius:10px;background:var(--panel2)}
.btn-close{margin-top:.5rem;border:0;padding:.55rem .9rem;border-radius:12px;background:#101a3d;color:#e6f0ff;border:1px solid #20306b;cursor:pointer}

/* ===== Notif ===== */
.feed{position:absolute;left:10px;bottom:72px;width:min(92%,380px);display:flex;flex-direction:column;gap:.5rem;z-index:20;pointer-events:none}
.note{pointer-events:auto;background:linear-gradient(180deg,#0f1a30,#0e1224);color:#dff6ea;border:1px solid #224254;border-left:3px solid #14c27f;
  border-radius:14px;padding:.7rem .75rem;box-shadow:0 12px 28px #0008;transform:translateY(10px);opacity:0;animation:flyin .35s ease forwards;font-size:.9rem}
.note .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:.25rem}
.note .tag{display:flex;align-items:center;gap:.4rem;color:#6cf7b1;font-weight:700}
.note .tag svg{width:16px;height:16px}.note .when{color:#87a3b3;font-size:.78rem}.note .msg{color:#e8fff6}
@keyframes flyin{to{transform:translateY(0);opacity:1}} .note.hide{animation:flyout .25s ease forwards}
@keyframes flyout{to{transform:translateY(10px);opacity:0}}

/* ===== Chat ===== */
.chat-wrap{display:grid;grid-template-rows:1fr auto;gap:.5rem}
.chat-box{height:320px;overflow:auto;background:#0e1430;border:1px solid var(--line);border-radius:12px;padding:.7rem}
.chat-msg{margin:.35rem 0;padding:.5rem .65rem;border-radius:10px;max-width:85%}
.chat-msg.you{background:#152457;color:#dfe7ff;margin-left:auto}
.chat-msg.ai{background:#12243a;color:#bfe6ff;border:1px solid #1f3a64}
.chat-row{display:flex;gap:.5rem}
.chat-input{flex:1;padding:.6rem .75rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#cfe3ff}
.chat-send{border:0;border-radius:12px;background:linear-gradient(90deg,var(--ac1),var(--ac2));padding:.6rem .9rem;font-weight:800;color:#001c2a;cursor:pointer}
.typing{display:inline-flex;gap:6px;align-items:center}
.typing i{width:6px;height:6px;border-radius:50%;background:#9fd;opacity:.25;animation:blink 1s infinite}
.typing i:nth-child(2){animation-delay:.2s}.typing i:nth-child(3){animation-delay:.4s}
@keyframes blink{0%{opacity:.25}50%{opacity:1}100%{opacity:.25}}

/* ===== Name modal (Live Chat) ===== */
.name-modal{position:fixed;inset:0;display:none;place-items:center;z-index:75;background:#0007}
.name-modal.show{display:grid}
.name-card{width:min(420px,92%);background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 24px 60px #000b}
.name-row{display:flex;gap:.5rem}
.name-input{flex:1;padding:.6rem .75rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#cfe3ff}
.name-btn{border:0;border-radius:12px;background:linear-gradient(90deg,var(--ac1),var(--ac2));padding:.6rem .9rem;font-weight:800;color:#001c2a;cursor:pointer}

/* ===== Account Page ===== */
.account-wrap{display:grid;gap:14px}
.account-hero{display:grid;place-items:center;padding:16px;border-radius:16px;background:#0e1326;border:1px solid #1b244a}
.account-hero img{width:120px;height:120px;object-fit:contain;filter:drop-shadow(0 8px 24px #ff3b3b33)}
.account-title{font-size:1.4rem;font-weight:800;letter-spacing:.04em;margin-top:6px}
.kv{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:var(--panel2)}
.kv svg{width:18px;height:18px;opacity:.9}
.kv label{min-width:92px;color:#9fb0d7}
.kv .val{font-weight:700;letter-spacing:.02em}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
.account-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tile{display:grid;place-items:center;padding:14px;border-radius:12px;background:#0e1533;border:1px solid #1b2550}
.big-num{font-size:1.2rem;font-weight:800}

/* Phone frame */
@media (min-width:560px){
  body{display:grid;place-items:center}
  .phone{width:min(100%,420px);height:820px;background:#09101e;border-radius:28px;box-shadow:0 25px 80px #0007;border:1px solid #152046;overflow:hidden;position:relative}
  .app{height:100%}.feed{bottom:72px}
}
@media (max-width:559px){.phone{height:100vh;position:relative}}
</style>
</head>
<body>
<!-- ===== LOGIN ===== -->
<div id="authWrap" class="auth-wrap">
  <div class="auth-card">
    <div class="auth-header">
      <div class="auth-logo"><img src="https://files.catbox.moe/296pyr.jpg" alt="Logo" style="width:60px;height:60px;border-radius:14px;object-fit:cover"></div>
      <div class="title">ARDS V15</div><div class="subtitle">WELCOME TO LOGIN PORTAL ARDS V15</div>
    </div>
    <div class="field"><div class="label">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Username
    </div><div class="ipt"><input id="authUsername" placeholder="Enter username"></div></div>
    <div class="field"><div class="label">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 17a5 5 0 0 0 5-5V7a5 5 0 0 0-10 0v5a5 5 0 0 0 5 5z"/><path d="M19 11H5"/></svg> Password
    </div><div class="ipt"><input id="authPassword" type="password" placeholder="Enter password"></div></div>
    <label class="remember"><input id="rememberMe" type="checkbox"> Ingatkan</label>
    <button id="btnLogin" class="btn-grad">ACCESS SYSTEM</button>
    <div id="authMsg" class="muted-center allow-select"></div>
  </div>
</div>

<!-- ===== APP ===== -->
<div id="appWrap" class="phone" hidden>
  <div class="app">
    <header class="topbar">
      <button class="hamburger" onclick="toggleDrawer()" aria-label="Menu"><span class="bars"></span></button>
      <div><div class="brand">ARDS V15</div><small style="color:#7fbfff">dashboard</small></div>

      <!-- Battery pill -->
      <div id="batteryPill" class="battery-pill" aria-live="polite" title="Battery">
        <div class="battery-icon"><div class="battery-fill" id="batteryFill"></div></div>
        <div class="battery-txt" id="batteryTxt">--%</div>
      </div>

      <!-- Actions -->
      <button class="tab" onclick="switchTab(this);go('chat')" style="display:flex;align-items:center;gap:.3rem;padding:.35rem .6rem;border:1px solid var(--line);border-radius:10px;background:#0f1736;margin-left:.4rem">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg><small>Chat AI</small>
      </button>
      <button class="tab" onclick="logout()" style="padding:.35rem .6rem;border:1px solid var(--line);border-radius:10px;background:#0f1736">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><small>Logout</small>
      </button>

      <!-- Music toggle (pojok kanan) -->
      <button id="musicBtn" class="music-btn" title="Music">
        <svg id="musicIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18V5l12-2v13"/>
          <circle cx="6" cy="18" r="3"/>
          <circle cx="18" cy="16" r="3"/>
        </svg>
      </button>
    </header>

    <!-- Drawer -->
    <aside class="drawer" role="navigation" aria-label="Sidebar">
      <div class="d-head">
        <div class="avatar-wrap" onclick="triggerAvatarPicker()" title="Ubah foto">
          <div class="avatar"><img id="avatarImg" src="https://files.catbox.moe/6xyox8.jpg" alt="avatar"></div>
          <div class="edit-badge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>
          </div>
        </div>
        <input id="avatarPicker" type="file" accept="image/*" hidden>
        <div><div class="d-title">ARDS V15</div><span class="badge">Execution Mode</span></div>
      </div>
      <nav class="menu">
        <a class="item active" href="#" onclick="toggleDrawer(false);go('home');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l9-9 9 9"/><path d="M9 21V9h6v12"/></svg> Dashboard
        </a>
        <a class="item" href="#" onclick="toggleDrawer(false);go('account');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Account
        </a>
        <a class="item" href="#" onclick="toggleDrawer(false);go('bug');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5L5.5 20l2-7L2 9h7z"/></svg> WhatsApp (Bug)
        </a>
        <a class="item" href="#" onclick="toggleDrawer(false);go('ddos');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="12" rx="2"/><path d="M7 20h10"/></svg> DDoS
        </a>
        <a class="item" href="#" onclick="toggleDrawer(false);go('track');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 12-9 12S3 17 3 10a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg> Track IP
        </a>
        <a class="item" href="#" onclick="toggleDrawer(false);go('chat');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg> Chat AI
        </a>
        <a class="item" href="#" onclick="toggleDrawer(false);go('live');setActive(this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 8h10M7 12h6"/></svg> Live Chat
        </a>
      </nav>
      <div class="footer">© 2025 ARDS V15</div>
    </aside>
    <div class="overlay" onclick="toggleDrawer(false)" aria-hidden="true"></div>

    <main class="content">
      <section class="panel hero"><img src="https://files.catbox.moe/qs4i0m.jpg" alt="header"></section>
      <div id="views">
        <br>
        <!-- HOME -->
        <section id="home" class="page active">
          <div class="cards"><div class="card"><h3>Server Stats</h3>
            <div class="stat">
              <div style="display:flex;align-items:center;gap:.55rem">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <div><div style="font-weight:700;font-size:.92rem">Online Users</div><small style="color:var(--tx2)">Real-time</small></div>
              </div>
              <div style="display:flex;align-items:center;gap:.45rem"><span class="status-dot"></span> <strong id="uCount">82</strong></div>
            </div>
            <div class="stat">
              <div style="display:flex;align-items:center;gap:.55rem">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                <div><div style="font-weight:700;font-size:.92rem">Active Sender</div><small style="color:var(--tx2)">Last 60s</small></div>
              </div>
              <div style="display:flex;align-items:center;gap:.45rem"><span class="status-dot" style="background:var(--warn);box-shadow:0 0 10px var(--warn)"></span> <strong id="aCount">9</strong></div>
            </div>
          </div></div><div style="height:56px"></div>
        </section>

        <!-- Account -->
        <section id="account" class="page">
          <div class="account-wrap">
            <div class="account-hero">
              <img src="https://files.catbox.moe/39navm.jpg" alt="logo" />
              <div class="account-title">Account</div>
            </div>
            <div class="card">
              <div class="kv">
                <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <label>Username:</label><span id="accUser" class="val mono">-</span>
              </div>
              <div class="kv">
                <svg viewBox="0 0 24 24"><path d="M12 17a5 5 0 0 0 5-5V7a5 5 0 0 0-10 0v5a5 5 0 0 0 5 5z"/><path d="M19 11H5"/></svg>
                <label>Password:</label><span id="accPass" class="val mono">******</span>
              </div>
              <div class="kv">
                <svg viewBox="0 0 24 24"><path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5L5.5 20l2-7L2 9h7z"/></svg>
                <label>Role:</label><span id="accRole" class="val">-</span>
              </div>
              <div class="kv">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <label>Expired:</label><span id="accExp" class="val mono">-</span>
              </div>
            </div>
            <div class="account-grid">
              <div class="tile">
                <div class="mono" style="opacity:.7">Session</div>
                <div id="accSess" class="mono big-num">-</div>
              </div>
              <div class="tile">
                <div class="mono" style="opacity:.7">Days remaining</div>
                <div id="accDays" class="big-num">-</div>
              </div>
            </div>
          </div>
        </section>

        <!-- BUG WA -->
        <section id="bug" class="page">
          <div class="cards"><div class="card"><h3>Attack • Bug WA</h3><small style="color:var(--tx2)">.</small><div style="height:.5rem"></div>
            <div style="display:flex;gap:.55rem;flex-wrap:wrap">
              <input id="waNumber" type="tel" inputmode="numeric" pattern="\\+?\\d{9,15}" placeholder="+62812xxxxxxx" style="flex:1;padding:.65rem .85rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#9fd9ff;min-width:220px">
              <select id="bugType" style="padding:.65rem .85rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#9fd9ff">
                <option>Bug 1 — Delay Message</option><option>Bug 2 — Sender Loop</option><option>Bug 3 — Ghost Notification</option><option>Bug 4 — Sticker Flood</option><option>Bug 5 — Media Spam</option>
              </select>
              <button class="btn-grad" onclick="startProgress('Attack • Bug WA')">Mulai</button>
            </div>
          </div></div>
        </section>

        <!-- DDoS -->
        <section id="ddos" class="page">
          <div class="cards"><div class="card"><h3>DDoS</h3><small style="color:var(--tx2)">Masukkan URL target (mock UI)</small><div style="height:.5rem"></div>
            <div style="display:flex;gap:.55rem;flex-wrap:wrap">
              <input id="ddosUrl" type="url" placeholder="https://contoh.com" style="flex:1;padding:.65rem .85rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#9fd9ff;min-width:220px">
              <select style="padding:.65rem .85rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#9fd9ff"><option>Mode Fast</option><option>Mode Slow</option></select>
              <button class="btn-grad" onclick="startProgress('DDoS')">Run</button>
            </div>
          </div></div>
        </section>

        <!-- Track IP -->
        <section id="track" class="page">
          <div class="cards"><div class="card"><h3>Track IP (Mock)</h3>
            <div style="display:flex;gap:.55rem;flex-wrap:wrap">
              <input id="ipInput" placeholder="192.0.2.1" style="flex:1;padding:.65rem .85rem;border-radius:12px;border:1px solid var(--line);background:transparent;color:#9fd9ff;min-width:220px">
              <button class="btn-grad" onclick="startProgress('Track IP')">Lookup</button>
            </div>
          </div></div>
        </section>

        <!-- Chat AI (Gemini) -->
        <section id="chat" class="page">
          <div class="cards"><div class="card"><h3>Chat AI (Gemini)</h3>
            <div class="chat-wrap">
              <div id="chatBox" class="chat-box" aria-live="polite"></div>
              <div class="chat-row"><input id="chatInput" class="chat-input" placeholder="Tanyakan apa saja..."><button class="chat-send" id="chatSend">Kirim</button></div>
            </div>
          </div></div>
        </section>

        <!-- Live Chat -->
        <section id="live" class="page">
          <div class="cards"><div class="card"><h3>Live Chat</h3>
            <div class="chat-wrap">
              <div id="liveBox" class="chat-box" aria-live="polite"></div>
              <div class="chat-row"><input id="liveInput" class="chat-input" placeholder="Tulis pesan..."><button class="chat-send" id="liveSend">Kirim</button></div>
            </div>
          </div></div>
        </section>
      </div>
    </main>

    <nav class="bottombar">
      <button class="tab active" onclick="switchTab(this);go('home')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l9-9 9 9"/><path d="M9 21V9h6v12"/></svg><small>Home</small></button>
      <button class="tab" onclick="switchTab(this);go('bug')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5L5.5 20l2-7L2 9h7z"/></svg><small>Bug WA</small></button>
      <button class="tab" onclick="switchTab(this);go('ddos')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="12" rx="2"/><path d="M7 20h10"/></svg><small>DDoS</small></button>
      <button class="tab" onclick="switchTab(this);go('track')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 12-9 12S3 17 3 10a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg><small>Track IP</small></button>
      <button class="tab" onclick="switchTab(this);go('live')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 8h10M7 12h6"/></svg><small>Live</small></button>
    </nav>

    <div id="feed" class="feed" aria-live="polite"></div>
  </div>
</div>

<!-- Modals -->
<div id="progressModal" class="modal" aria-hidden="true"><div class="modal-card"><strong id="mTitle">Running</strong>
  <div class="progress"><i id="bar"></i></div>
  <div class="meta"><span id="left">20s left</span><span id="state">Preparing...</span></div>
  <div class="indicator" id="indicator">Status: Waiting</div>
  <button class="btn-close" onclick="closeProgress()">Close</button></div></div>

<div id="successModal" class="modal" aria-hidden="true"><div class="modal-card">
  <strong>Success!</strong><p id="successText">Login berhasil. Selamat datang.</p><button class="btn-close" onclick="closeSuccess()">OK</button></div></div>

<!-- Music confirm modal -->
<div id="musicConfirm" class="modal" aria-hidden="true">
  <div class="modal-card">
    <strong>Putar Musik?</strong>
    <p>Izinkan aplikasi memutar musik acak dari playlist kamu.</p>
    <div style="display:flex;gap:.5rem;justify-content:center;margin-top:.5rem">
      <button id="musicNo" class="btn-close" style="background:#101a3d">Tidak</button>
      <button id="musicYes" class="btn-close" style="background:linear-gradient(90deg,var(--ac1),var(--ac2));color:#001c2a;border:0">Ya, Putar</button>
    </div>
  </div>
</div>

<div id="nameModal" class="name-modal" aria-hidden="true"><div class="name-card">
  <h4>Masukkan nama untuk Live Chat</h4><div class="name-row"><input id="nameInput" class="name-input" placeholder="Nama kamu..."><button class="name-btn" id="nameSave">Simpan</button></div>
</div></div>

<!-- Hidden audio element -->
<audio id="bgm" preload="none" crossorigin="anonymous"></audio>

<!-- ===== App UI + Chat (non-module) ===== -->
<script>
/* Anti copy/zoom */
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('copy',e=>e.preventDefault());
document.addEventListener('cut',e=>e.preventDefault());
document.addEventListener('selectstart',e=>{const t=(e.target.tagName||'').toUpperCase();if(t!=='INPUT'&&t!=='TEXTAREA'&&!e.target.classList.contains('allow-select'))e.preventDefault()});
document.addEventListener('wheel',e=>{if(e.ctrlKey)e.preventDefault()},{passive:false});
document.addEventListener('keydown',e=>{if(e.ctrlKey&&['+','-','0'].includes(e.key))e.preventDefault()});

/* Tabs & pages */
function switchTab(el){document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));el.classList.add('active')}
function go(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');if(id==='live')ensureNameFlow()}

/* Drawer */
const body=document.body;
function toggleDrawer(force){const open=force!==undefined?force:!body.classList.contains('drawer-open');body.classList.toggle('drawer-open',open)}
function setActive(a){document.querySelectorAll('.drawer .item').forEach(i=>i.classList.remove('active'));a.classList.add('active')}
let startX=null;window.addEventListener('load',()=>{const ov=document.querySelector('.overlay');if(!ov)return;ov.addEventListener('touchstart',e=>startX=e.changedTouches[0].clientX);ov.addEventListener('touchend',e=>{if(startX&&e.changedTouches[0].clientX<startX-30)toggleDrawer(false);startX=null})});
history.replaceState(null,'');history.pushState(null,'');window.addEventListener('popstate',()=>{if(body.classList.contains('drawer-open')){toggleDrawer(false);history.pushState(null,'')}});

/* Demo counters */
setInterval(()=>{const u=document.getElementById('uCount'),a=document.getElementById('aCount');if(!u||!a)return;u.textContent=70+Math.floor(Math.random()*30);a.textContent=5+Math.floor(Math.random()*7)},1800);

/* Notifikasi berkala */
const feed=document.getElementById('feed');
const titles=['Akun berhasil dibanned','Bug WA berhasil dieksekusi','Spam media berhasil dikirim','Delay message aktif','Ghost notification terdeteksi'];
const bodies=[n=>`Akun ${n} berhasil dibanned permanen`,n=>`Target ${n} menerima burst notifikasi`,n=>`Target ${n} terkena flood media`,n=>`Target ${n} mengalami delay pesan`,n=>`Nomor ${n} memunculkan ghost notif`];
function r(min,max){return Math.floor(Math.random()*(max-min+1))+min}
function maskPhone(){const p=['+62 81','+62 82','+62 83','+62 85','+62 87','+62 88','+62 89'][r(0,6)];const mid=r(100,999),tail=r(1000,9999);return `${p}${r(0,9)} ${mid}-****-${String(tail)}`}
function note(){const i=r(0,titles.length-1),num=maskPhone();const n=document.createElement('div');n.className='note';n.innerHTML=`<div class="top"><div class="tag"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 12-9 12S3 17 3 10a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg> ARDS V15 Notify</div><div class="when">baru saja</div></div><div class="msg"><strong>${titles[i]}</strong><br>${bodies[i](num)}</div>`;feed.prepend(n);setTimeout(()=>n.classList.add('hide'),3500);setTimeout(()=>n.remove(),3800)}
setInterval(note,8000);

/* Progress modal + toast */
const pm=document.getElementById('progressModal'),bar=document.getElementById('bar'),left=document.getElementById('left'),state=document.getElementById('state'),ind=document.getElementById('indicator'),mTitle=document.getElementById('mTitle');let timer=null;
function startProgress(kind){
  if(kind.includes('Bug WA')){const n=document.getElementById('waNumber');if(!n.value.trim()){showToast('Nomor target wajib diisi');return}}
  if(kind==='DDoS'){const u=document.getElementById('ddosUrl');if(!u.value.trim()){showToast('URL target wajib diisi');return}try{new URL(u.value)}catch{showToast('Format URL tidak valid');return}}
  mTitle.textContent=kind;bar.style.width='0%';left.textContent='20s left';state.textContent='Preparing...';ind.textContent='Status: In progress';pm.classList.add('show');let s=0,total=20;clearInterval(timer);timer=setInterval(()=>{s++;bar.style.width=Math.round((s/total)*100)+'%';left.textContent=(total-s)+'s left';if(s===6)state.textContent='Processing...';if(s===13)state.textContent='Finalizing...';if(s>=total){clearInterval(timer);state.textContent='Complete';ind.textContent='Status: Completed';setTimeout(()=>pm.classList.remove('show'),800)}},1000)}
function closeProgress(){clearInterval(timer);pm.classList.remove('show')}
let tt;function showToast(msg){let t=document.getElementById('toast');if(!t){t=document.createElement('div');t.id='toast';t.style.cssText='position:fixed;left:50%;bottom:88px;transform:translateX(-50%) translateY(14px);background:#0f1736;border:1px solid #1d2a57;border-radius:12px;padding:.55rem .8rem;box-shadow:0 12px 24px #0008;opacity:0;transition:.2s;z-index:80;font-size:.9rem';document.body.appendChild(t)}t.textContent=msg;t.style.opacity='1';t.style.transform='translateX(-50%) translateY(0)';clearTimeout(tt);tt=setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(-50%) translateY(14px)'},1800)}
function showSuccess(msg){document.getElementById('successText').textContent=msg||'Success';document.getElementById('successModal').classList.add('show')}
function closeSuccess(){document.getElementById('successModal').classList.remove('show')}

/* ===== Battery ===== */
async function initBattery(){
  const pill=document.getElementById('batteryPill');
  const fill=document.getElementById('batteryFill');
  const txt=document.getElementById('batteryTxt');
  if(!navigator.getBattery){ txt.textContent='--%'; return; }
  try{
    const b=await navigator.getBattery();
    const render=()=>{
      const pct=Math.round(b.level*100);
      fill.style.width=Math.max(6,Math.min(100,pct))+'%';
      fill.style.background=b.charging?'linear-gradient(90deg,#23d18b,#4ad0ff)':'linear-gradient(90deg,#7b5cff,#4ad0ff)';
      txt.textContent=pct+'%'+(b.charging?' • Charging':'');
    };
    render();
    b.addEventListener('levelchange',render);
    b.addEventListener('chargingchange',render);
  }catch(_){ txt.textContent='--%'; }
}
initBattery();

/* ===== MUSIC PLAYER ===== */

// ==== MUSIC PLAYER CONFIG ====
// Ganti tiga URL di bawah dengan link musik kamu.
const PLAYLIST_SOURCE = [
  "https://files.catbox.moe/9egyed.mp3",
  "https://files.catbox.moe/jw82sf.mp3",
  "https://files.catbox.moe/mryjri.mp3"
];
// =================================

const musicBtn = document.getElementById('musicBtn');
const musicIcon = document.getElementById('musicIcon');
const musicModal = document.getElementById('musicConfirm');
const musicYes = document.getElementById('musicYes');
const musicNo  = document.getElementById('musicNo');
const bgm = document.getElementById('bgm');

let musicAllowed = false;
let order = [];
let idx = 0;
let isPlaying = false;

function shuffle(a){
  const arr = a.slice();
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function ensureOrder(){
  if(!order.length){
    const valid = PLAYLIST_SOURCE.filter(Boolean);
    order = shuffle(valid);
    idx = 0;
  }
}
function loadCurrent(){
  ensureOrder();
  if(!order.length){
    showToast('Playlist kosong. Tempelkan 3 link musik dulu.');
    return false;
  }
  bgm.src = order[idx];
  return true;
}
function nextTrack(){
  idx++;
  if(idx>=order.length){
    // habis — acak ulang supaya bener-bener random tiap loop
    order = shuffle(PLAYLIST_SOURCE.filter(Boolean));
    idx = 0;
  }
  if(loadCurrent()){
    bgm.play().catch(()=>{ /* ignore */ });
  }
}
bgm.addEventListener('ended', nextTrack);

// Toggle UI state
function setMusicActive(active){
  musicBtn.classList.toggle('active', active);
  isPlaying = active;
}

// Confirm flow
musicBtn.addEventListener('click', ()=>{
  if(!musicAllowed){
    musicModal.classList.add('show');
    return;
  }
  // sudah diizinkan — toggle play/pause
  if(isPlaying){
    bgm.pause();
    setMusicActive(false);
    showToast('Musik dijeda');
  }else{
    if(!bgm.src) loadCurrent();
    bgm.play().then(()=>{
      setMusicActive(true);
      showToast('Musik diputar');
    }).catch(()=>{
      showToast('Gagal memutar. Cek link musik.');
    });
  }
});

musicYes.addEventListener('click', ()=>{
  musicAllowed = true;
  musicModal.classList.remove('show');
  if(!bgm.src && !loadCurrent()) return;
  bgm.play().then(()=>{
    setMusicActive(true);
    showToast('Musik diputar (acak)');
  }).catch(()=>{
    showToast('Autoplay gagal. Tekan tombol musik lagi.');
  });
});
musicNo.addEventListener('click', ()=> musicModal.classList.remove('show'));

/* ===== Chat AI (Gemini) ===== */
const GEMINI_API_KEY="AIzaSyATye6_Fv1UcO4r34sbnqxLtAhGVDSHASo";
const GEMINI_MODELS=["gemini-2.5-flash","gemini-2.5-flash-exp","gemini-2.0-flash-exp","gemini-2.0-flash","gemini-1.5-flash-latest"];
const chatBox=document.getElementById('chatBox'),chatIn=document.getElementById('chatInput'),chatSend=document.getElementById('chatSend');

function addMsg(t,who='you'){
  const d=document.createElement('div');
  d.className='chat-msg '+(who==='you'?'you':'ai');
  d.textContent=t;
  chatBox.appendChild(d);
  chatBox.scrollTop=chatBox.scrollHeight;
  return d;
}
function addTyping(){
  const d=document.createElement('div');
  d.className='chat-msg ai';
  d.innerHTML='<span class="typing"><i></i><i></i><i></i></span>';
  chatBox.appendChild(d);
  chatBox.scrollTop=chatBox.scrollHeight;
  return d;
}
function typeInto(el,t,s=12){
  return new Promise(r=>{
    el.textContent='';
    let i=0;
    const iv=setInterval(()=>{
      el.textContent+=t[i++]||'';
      chatBox.scrollTop=chatBox.scrollHeight;
      if(i>=t.length){clearInterval(iv);r()}
    },s);
  });
}
async function callGemini(m,prompt,signal){
  const url=`https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`;
  const res=await fetch(url,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({contents:[{parts:[{text:prompt}]}],generationConfig:{temperature:0.7,maxOutputTokens:512}}),
    signal,mode:'cors',cache:'no-store'
  });
  if(!res.ok){
    const txt=await res.text().catch(()=> ''); const err=new Error(`HTTP ${res.status}: ${txt}`); err.status=res.status; throw err;
  }
  const data=await res.json();
  return data?.candidates?.[0]?.content?.parts?.[0]?.text||'';
}
async function sendChat(){
  const q=(chatIn.value||'').trim();
  if(!q) return;
  chatSend.disabled=true; chatIn.disabled=true; const old=chatSend.textContent; chatSend.textContent='...';
  addMsg(q,'you'); chatIn.value='';
  const typing=addTyping();
  const ctl=new AbortController(); const tm=setTimeout(()=>ctl.abort(),25000);
  try{
    let ans='',used='',lastErr;
    for(const m of GEMINI_MODELS){
      try{ ans=await callGemini(m,q,ctl.signal); used=m; if(ans && ans.trim()) break; }
      catch(e){ lastErr=e; if([400,403,404].includes(e.status)) continue; else throw e; }
    }
    clearTimeout(tm);
    const bubble=document.createElement('div'); bubble.className='chat-msg ai';
    chatBox.replaceChild(bubble,typing);
    if(ans && ans.trim()){ await typeInto(bubble, ans.trim()+`\n\n— ${used}`, 12); }
    else{ bubble.textContent='Tidak ada respons dari model.'; console.warn(lastErr); }
  }catch(e){
    clearTimeout(tm);
    const bubble=document.createElement('div'); bubble.className='chat-msg ai';
    chatBox.replaceChild(bubble,typing);
    bubble.textContent=(e.name==='AbortError')?'Timeout: server lambat/terblokir.':'Gagal menghubungi Gemini API.';
    console.error(e);
  }finally{
    chatSend.disabled=false; chatIn.disabled=false; chatSend.textContent=old; chatIn.focus();
  }
}
chatSend.addEventListener('click',sendChat);
chatIn.addEventListener('keydown',e=>{ if(e.key==='Enter') sendChat(); });

/* ===== Live Chat cache + nama + avatar ===== */
const CACHE_KEY='ards_live_cache_v3',MAX_CACHE=200,NAME_KEY='ards_live_name',CLIENT_KEY='ards_live_client_id',AVATAR_KEY='ards_avatar_dataurl_v1';
const liveBox=document.getElementById('liveBox'),liveIn=document.getElementById('liveInput'),liveBtn=document.getElementById('liveSend');
let myId=localStorage.getItem(CLIENT_KEY);
if(!myId){ myId=(crypto.randomUUID?.()||Math.random().toString(36).slice(2))+Date.now(); localStorage.setItem(CLIENT_KEY,myId); }

function getCache(){ try{return JSON.parse(localStorage.getItem(CACHE_KEY)||'[]')}catch{return[]} }
function setCache(a){ try{localStorage.setItem(CACHE_KEY,JSON.stringify(a.slice(-MAX_CACHE)))}catch{} }
function cacheAdd(o){ const a=getCache(); a.push(o); setCache(a); }

function renderLive(m){
  const d=document.createElement('div');
  d.className='chat-msg '+(m.clientId===myId?'you':'ai');
  d.textContent=(m.clientId===myId)?`Saya (${m.name}): ${m.text}`:`${m.name}: ${m.text}`;
  d.dataset.key=m.key||'';
  liveBox.appendChild(d);
  liveBox.scrollTop=liveBox.scrollHeight;
}
function restoreCache(){ liveBox.innerHTML=''; getCache().forEach(renderLive); liveBox.scrollTop=liveBox.scrollHeight; }

document.addEventListener('DOMContentLoaded',()=>{ restoreCache(); loadAvatarFromStorage(); updateAccountUI(); });

const nameModal=document.getElementById('nameModal'),nameInput=document.getElementById('nameInput'),nameSave=document.getElementById('nameSave');
function ensureNameFlow(){ const n=(localStorage.getItem(NAME_KEY)||'').trim(); if(!n){ nameModal.classList.add('show'); setTimeout(()=>nameInput.focus(),50); } }
nameSave.addEventListener('click',()=>{ const v=(nameInput.value||'').trim(); if(!v){showToast('Nama wajib diisi');return} localStorage.setItem(NAME_KEY,v); nameModal.classList.remove('show')});

/* Avatar picker + persist */
const avatarImg=document.getElementById('avatarImg');
function triggerAvatarPicker(){ document.getElementById('avatarPicker').click() }
document.getElementById('avatarPicker').addEventListener('change',async(e)=>{
  const file=e.target.files&&e.target.files[0]; if(!file) return;
  if(!file.type.startsWith('image/')){ showToast('File harus gambar'); return; }
  try{
    const dataUrl=await readAndResize(file,256);
    avatarImg.src=dataUrl;
    localStorage.setItem(AVATAR_KEY,dataUrl);
    showToast('Foto profil disimpan');
  }catch(err){ console.error(err); showToast('Gagal memproses gambar'); }
  e.target.value="";
});
function loadAvatarFromStorage(){ const saved=localStorage.getItem(AVATAR_KEY); if(saved){ avatarImg.src=saved; } }
function readAndResize(file,maxSize){
  return new Promise((resolve,reject)=>{
    const fr=new FileReader();
    fr.onerror=()=>reject(new Error('read error'));
    fr.onload=()=>{
      const img=new Image();
      img.onload=()=>{
        const c=document.createElement('canvas'),ctx=c.getContext('2d');
        let w=img.width,h=img.height; const s=Math.min(1,maxSize/Math.max(w,h));
        w=Math.round(w*s); h=Math.round(h*s);
        c.width=w; c.height=h; ctx.drawImage(img,0,0,w,h);
        resolve(c.toDataURL('image/jpeg',0.85));
      };
      img.onerror=()=>reject(new Error('image error')); img.src=fr.result;
    };
    fr.readAsDataURL(file);
  });
}

/* ===== Account filler ===== */
const ACC_USER_KEY='acc_username';
const ACC_PLEN_KEY='acc_pass_len';
const ACC_EXP_KEY ='acc_exp_date';
const ACC_SESS_KEY='acc_session';

function detectRole(){
  const ua=(navigator.userAgent||'').toLowerCase();
  return /itel\s*a70/.test(ua) ? 'OWNER' : 'buyer';
}
function maskStars(len){const n=Math.max(6, Math.min(24, +len||0));return '•'.repeat(n||6)}
function leftDays(expStr){
  const exp=new Date(expStr+'T00:00:00'); const now=new Date();
  return Math.max(0, Math.ceil((exp-now)/86400000));
}
function randSess(){return (crypto.randomUUID?.()||Math.random().toString(36).slice(2)).replace(/-/g,'').slice(0,6)+'…';}

function updateAccountUI(){
  const uEl=document.getElementById('accUser');
  const pEl=document.getElementById('accPass');
  const rEl=document.getElementById('accRole');
  const eEl=document.getElementById('accExp');
  const sEl=document.getElementById('accSess');
  const dEl=document.getElementById('accDays');
  if(!uEl) return;

  const fallbackUser=(document.getElementById('authUsername')?.value||'').trim() || 'UNKNOWN';
  const uname=(localStorage.getItem(ACC_USER_KEY)||fallbackUser).toUpperCase();

  let pLen=parseInt(localStorage.getItem(ACC_PLEN_KEY)||'0',10);
  if(!pLen){ pLen=(document.getElementById('authPassword')?.value||'').length||6; }

  let exp=localStorage.getItem(ACC_EXP_KEY);
  if(!exp){ exp='...'; try{ localStorage.setItem(ACC_EXP_KEY,exp);}catch{} }

  let sess=localStorage.getItem(ACC_SESS_KEY);
  if(!sess){ sess=randSess(); try{localStorage.setItem(ACC_SESS_KEY,sess)}catch{} }

  uEl.textContent=uname;
  pEl.textContent=maskStars(pLen);
  rEl.textContent=detectRole();
  eEl.textContent=exp;
  sEl.textContent=sess;
  dEl.textContent=leftDays(exp);
  if(rEl.textContent==='OWNER'){ rEl.style.color='#ff6b6b'; rEl.style.letterSpacing='.06em'; }
}

/* Simpan saat login berhasil */
window.__storeAccInfo=function(u,p){
  try{
    localStorage.setItem(ACC_USER_KEY,(u||'').trim());
    localStorage.setItem(ACC_PLEN_KEY,String((p||'').length||6));
  }catch{}
  updateAccountUI();
};
</script>

<!-- ===== Firebase Auth ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth,onAuthStateChanged,signInWithEmailAndPassword,signOut,setPersistence,browserSessionPersistence } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
const firebaseConfig={apiKey:"AIzaSyArE6B5jQCSECpOusTxrOYmUsjeFEa17YI",authDomain:"bugwa-1fc47.firebaseapp.com",projectId:"bugwa-1fc47",storageBucket:"bugwa-1fc47.firebasestorage.app",messagingSenderId:"309575475227",appId:"1:309575475227:web:c2a7a9123afb30023698be"};
const app=initializeApp(firebaseConfig);const auth=getAuth(app);
await setPersistence(auth,browserSessionPersistence).catch(()=>{});try{await signOut(auth)}catch(_){}
const authWrap=document.getElementById('authWrap'),appWrap=document.getElementById('appWrap'),msgEl=document.getElementById('authMsg'),uEl=document.getElementById('authUsername'),pEl=document.getElementById('authPassword');
let userInteracted=false;const asEmail=u=> (u||"").trim()?(u.trim()+"@gmail.com"):null;
async function doLogin(){userInteracted=true;msgEl.textContent="";const email=asEmail(uEl.value),pass=pEl.value;if(!email){msgEl.textContent="Username wajib diisi";userInteracted=false;return}if(!pass){msgEl.textContent="Password wajib diisi";userInteracted=false;return}
try{
  await signInWithEmailAndPassword(auth,email,pass);
  window.__storeAccInfo?.(uEl.value, pEl.value); // simpan ke Account
  (window.showSuccess||(()=>{}))('Login berhasil. Selamat datang.');
}catch(e){msgEl.textContent="Login gagal. Periksa username / password.";userInteracted=false}}
document.getElementById('btnLogin').addEventListener('click',doLogin);
onAuthStateChanged(auth,(user)=>{if(user&&userInteracted){authWrap.style.display="none";appWrap.hidden=false}else{appWrap.hidden=true;authWrap.style.display="grid"}});
window.logout=async()=>{try{await signOut(auth)}catch(_){ }finally{userInteracted=false;appWrap.hidden=true;authWrap.style.display="grid"}};
</script>

<!-- ===== Firebase Realtime (Live Chat) ===== -->
<script type="module">
import { initializeApp as init2 } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

/* Gunakan databaseURL yang tepat untuk instance kamu */
const liveCfg={
  apiKey:"AIzaSyD7idMEXKmc0sbq6DTEJ9CywsffkdEYUWg",
  authDomain:"asuhyw.firebaseapp.com",
  projectId:"asuhyw",
  storageBucket:"asuhyw.firebasestorage.app",
  messagingSenderId:"566844256911",
  appId:"1:566844256911:web:2315c1e3d19da585a036fa",
  databaseURL:"https://asuhyw-default-rtdb.firebaseio.com/"
};
const liveApp=init2(liveCfg,'live-app');
const db=getDatabase(liveApp, liveCfg.databaseURL);

/* DOM */
const liveBox=document.getElementById('liveBox');
const liveIn=document.getElementById('liveInput');
const liveBtn=document.getElementById('liveSend');

/* Keys */
const NAME_KEY='ards_live_name', CLIENT_KEY='ards_live_client_id', CACHE_KEY='ards_live_cache_v3';
let myId=localStorage.getItem(CLIENT_KEY);
if(!myId){ myId=(crypto.randomUUID?.()||Math.random().toString(36).slice(2))+Date.now(); localStorage.setItem(CLIENT_KEY,myId); }

/* Render & cache (local) */
function renderLive(m){
  const d=document.createElement('div');
  d.className='chat-msg '+(m.clientId===myId?'you':'ai');
  d.textContent=(m.clientId===myId)?`Saya (${m.name}): ${m.text}`:`${m.name}: ${m.text}`;
  d.dataset.key=m.key||'';
  liveBox.appendChild(d);
  liveBox.scrollTop=liveBox.scrollHeight;
}
function cacheAdd(o){
  try{
    const a=JSON.parse(localStorage.getItem(CACHE_KEY)||'[]'); a.push(o);
    localStorage.setItem(CACHE_KEY, JSON.stringify(a.slice(-200)));
  }catch{}
}

/* GLOBAL stream */
const roomRef=ref(db,'rooms/global/messages');
onChildAdded(roomRef,(snap)=>{
  const v=snap.val()||{};
  const obj={key:snap.key,name:v.name||'Anon',text:v.text||'',ts:v.ts||Date.now(),clientId:v.clientId||''};
  renderLive(obj); cacheAdd(obj);
});

/* Send */
async function sendLive(){
  const name=(localStorage.getItem(NAME_KEY)||'').trim();
  if(!name){
    document.getElementById('nameModal').classList.add('show'); return;
  }
  const text=(liveIn.value||'').trim();
  if(!text) return;
  try{
    const payload={ name, text, clientId: myId, ts: serverTimestamp() };
    liveIn.value='';
    await push(roomRef, payload); // akan muncul via onChildAdded di semua device
  }catch(err){
    console.error(err);
    alert('Gagal mengirim ke server. Cek databaseURL & Rules RTDB.');
  }
}
liveBtn.addEventListener('click',sendLive);
liveIn.addEventListener('keydown',e=>{ if(e.key==='Enter') sendLive(); });

/* Save name from modal */
document.getElementById('nameSave').addEventListener('click',()=>{
  const v=(document.getElementById('nameInput').value||'').trim();
  if(!v) return;
  localStorage.setItem(NAME_KEY,v);
  document.getElementById('nameModal').classList.remove('show');
});
</script>
</body>
</html>